var NS = window.NS || {};
NS.POLYLINES = {SPI: {ARC1: [
    [8028.92, 8321],
    [8032.83, 8321.48],
    [8036.73, 8321.93],
    [8040.64, 8322.35],
    [8044.55, 8322.75],
    [8048.45, 8323.13],
    [8052.36, 8323.48],
    [8056.26, 8323.8],
    [8060.17, 8324.1],
    [8064.08, 8324.37],
    [8067.98, 8324.62],
    [8071.89, 8324.84],
    [8075.8, 8325.04],
    [8079.7, 8325.21],
    [8083.61, 8325.35],
    [8087.52, 8325.47],
    [8091.42, 8325.57],
    [8095.33, 8325.64],
    [8099.23, 8325.69],
    [8103.14, 8325.71],
    [8107.05, 8325.7],
    [8110.95, 8325.67],
    [8114.86, 8325.62],
    [8118.77, 8325.54],
    [8122.67, 8325.43],
    [8126.58, 8325.3],
    [8130.49, 8325.15],
    [8134.39, 8324.97],
    [8138.3, 8324.76],
    [8142.2, 8324.53],
    [8146.11, 8324.28],
    [8150.02, 8323.99],
    [8153.92, 8323.69],
    [8157.83, 8323.35],
    [8161.74, 8323],
    [8165.64, 8322.61],
    [8169.55, 8322.2],
    [8173.46, 8321.77],
    [8177.36, 8321.31],
    [8181.27, 8320.82],
    [8185.17, 8320.31],
    [8189.08, 8319.78],
    [8192.99, 8319.21],
    [8196.89, 8318.62],
    [8200.8, 8318.01],
    [8204.71, 8317.37],
    [8208.61, 8316.7],
    [8212.52, 8316.01],
    [8216.43, 8315.29],
    [8220.33, 8314.54],
    [8224.24, 8313.77],
    [8228.14, 8312.97],
    [8232.05, 8312.14],
    [8235.96, 8311.29],
    [8239.86, 8310.41],
    [8243.77, 8309.5],
    [8247.68, 8308.56],
    [8251.58, 8307.6],
    [8255.49, 8306.61],
    [8259.39, 8305.59],
    [8263.3, 8304.55],
    [8267.21, 8303.47],
    [8271.11, 8302.37],
    [8275.02, 8301.24],
    [8278.93, 8300.09],
    [8282.83, 8298.9],
    [8286.74, 8297.68],
    [8290.65, 8296.44],
    [8294.55, 8295.17],
    [8298.46, 8293.86],
    [8302.36, 8292.53],
    [8306.27, 8291.17],
    [8310.18, 8289.78],
    [8314.08, 8288.35],
    [8317.99, 8286.9],
    [8321.9, 8285.42],
    [8325.8, 8283.9],
    [8329.71, 8282.36],
    [8333.62, 8280.78],
    [8337.52, 8279.17],
    [8341.43, 8277.53],
    [8345.33, 8275.86],
    [8349.24, 8274.16],
    [8353.15, 8272.42],
    [8357.05, 8270.65],
    [8360.96, 8268.84],
    [8364.87, 8267],
    [8368.77, 8265.13],
    [8372.68, 8263.23],
    [8376.59, 8261.28],
    [8380.49, 8259.31],
    [8384.4, 8257.3],
    [8388.3, 8255.25],
    [8392.21, 8253.16],
    [8396.12, 8251.04],
    [8400.02, 8248.88],
    [8403.93, 8246.69],
    [8407.84, 8244.45],
    [8411.74, 8242.18],
    [8415.65, 8239.87],
    [8419.56, 8237.51]
], ARC2: [
    [8419.56, 8237.5],
    [8416.82, 8212.52],
    [8414.09, 8197.14],
    [8411.36, 8185.03],
    [8408.63, 8174.75],
    [8405.9, 8165.69],
    [8403.17, 8157.51],
    [8400.44, 8150.02],
    [8397.71, 8143.08],
    [8394.98, 8136.6],
    [8392.25, 8130.5],
    [8389.52, 8124.74],
    [8386.79, 8119.27],
    [8384.06, 8114.06],
    [8381.33, 8109.08],
    [8378.6, 8104.31],
    [8375.86, 8099.74],
    [8373.13, 8095.33],
    [8370.4, 8091.09],
    [8367.67, 8087],
    [8364.94, 8083.04],
    [8362.21, 8079.21],
    [8359.48, 8075.51],
    [8356.75, 8071.92],
    [8354.02, 8068.43],
    [8351.29, 8065.05],
    [8348.56, 8061.76],
    [8345.83, 8058.57],
    [8343.1, 8055.46],
    [8340.37, 8052.44],
    [8337.64, 8049.49],
    [8334.9, 8046.62],
    [8332.17, 8043.83],
    [8329.44, 8041.1],
    [8326.71, 8038.44],
    [8323.98, 8035.85],
    [8321.25, 8033.32],
    [8318.52, 8030.85],
    [8315.79, 8028.45],
    [8313.06, 8026.09],
    [8310.33, 8023.8],
    [8307.6, 8021.55],
    [8304.87, 8019.36],
    [8302.14, 8017.22],
    [8299.41, 8015.13],
    [8296.68, 8013.09],
    [8293.94, 8011.1],
    [8291.21, 8009.15],
    [8288.48, 8007.24],
    [8285.75, 8005.38],
    [8283.02, 8003.57],
    [8280.29, 8001.79],
    [8277.56, 8000.06],
    [8274.83, 7998.36],
    [8272.1, 7996.71],
    [8269.37, 7995.09],
    [8266.64, 7993.52],
    [8263.91, 7991.98],
    [8261.18, 7990.47],
    [8258.45, 7989.01],
    [8255.72, 7987.57],
    [8252.98, 7986.18],
    [8250.25, 7984.81],
    [8247.52, 7983.49],
    [8244.79, 7982.19],
    [8242.06, 7980.93],
    [8239.33, 7979.7],
    [8236.6, 7978.5],
    [8233.87, 7977.34],
    [8231.14, 7976.2],
    [8228.41, 7975.1],
    [8225.68, 7974.02],
    [8222.95, 7972.98],
    [8220.22, 7971.97],
    [8217.49, 7970.98],
    [8214.76, 7970.03],
    [8212.02, 7969.11],
    [8209.29, 7968.21],
    [8206.56, 7967.34],
    [8203.83, 7966.5],
    [8201.1, 7965.69],
    [8198.37, 7964.9],
    [8195.64, 7964.15],
    [8192.91, 7963.42],
    [8190.18, 7962.71],
    [8187.45, 7962.04],
    [8184.72, 7961.39],
    [8181.99, 7960.77],
    [8179.26, 7960.17],
    [8176.53, 7959.6],
    [8173.8, 7959.06],
    [8171.06, 7958.54],
    [8168.33, 7958.04],
    [8165.6, 7957.58],
    [8162.87, 7957.14],
    [8160.14, 7956.72],
    [8157.41, 7956.33],
    [8154.68, 7955.96],
    [8151.95, 7955.62],
    [8149.22, 7955.31],
    [8146.49, 7955.02]
], ARC3: [
    [8026.57, 8321],
    [8027.74, 8255.41],
    [8028.92, 8237.52],
    [8030.1, 8225.29],
    [8031.27, 8215.38],
    [8032.45, 8206.83],
    [8033.62, 8199.21],
    [8034.8, 8192.26],
    [8035.97, 8185.85],
    [8037.15, 8179.87],
    [8038.33, 8174.23],
    [8039.5, 8168.9],
    [8040.68, 8163.83],
    [8041.85, 8158.98],
    [8043.03, 8154.33],
    [8044.2, 8149.85],
    [8045.38, 8145.54],
    [8046.56, 8141.37],
    [8047.73, 8137.34],
    [8048.91, 8133.42],
    [8050.08, 8129.62],
    [8051.26, 8125.92],
    [8052.43, 8122.32],
    [8053.61, 8118.8],
    [8054.79, 8115.37],
    [8055.96, 8112.02],
    [8057.14, 8108.74],
    [8058.31, 8105.53],
    [8059.49, 8102.39],
    [8060.66, 8099.31],
    [8061.84, 8096.29],
    [8063.02, 8093.33],
    [8064.19, 8090.42],
    [8065.37, 8087.56],
    [8066.54, 8084.75],
    [8067.72, 8081.99],
    [8068.89, 8079.27],
    [8070.07, 8076.6],
    [8071.24, 8073.96],
    [8072.42, 8071.37],
    [8073.6, 8068.82],
    [8074.77, 8066.3],
    [8075.95, 8063.82],
    [8077.12, 8061.37],
    [8078.3, 8058.96],
    [8079.47, 8056.58],
    [8080.65, 8054.23],
    [8081.83, 8051.91],
    [8083, 8049.62],
    [8084.18, 8047.36],
    [8085.35, 8045.13],
    [8086.53, 8042.92],
    [8087.7, 8040.74],
    [8088.88, 8038.58],
    [8090.06, 8036.45],
    [8091.23, 8034.35],
    [8092.41, 8032.27],
    [8093.58, 8030.21],
    [8094.76, 8028.17],
    [8095.93, 8026.16],
    [8097.11, 8024.16],
    [8098.29, 8022.19],
    [8099.46, 8020.24],
    [8100.64, 8018.3],
    [8101.81, 8016.39],
    [8102.99, 8014.5],
    [8104.16, 8012.62],
    [8105.34, 8010.76],
    [8106.52, 8008.93],
    [8107.69, 8007.1],
    [8108.87, 8005.3],
    [8110.04, 8003.51],
    [8111.22, 8001.74],
    [8112.39, 7999.99],
    [8113.57, 7998.25],
    [8114.75, 7996.52],
    [8115.92, 7994.81],
    [8117.1, 7993.12],
    [8118.27, 7991.44],
    [8119.45, 7989.78],
    [8120.62, 7988.13],
    [8121.8, 7986.49],
    [8122.98, 7984.87],
    [8124.15, 7983.26],
    [8125.33, 7981.67],
    [8126.5, 7980.09],
    [8127.68, 7978.52],
    [8128.85, 7976.96],
    [8130.03, 7975.42],
    [8131.2, 7973.88],
    [8132.38, 7972.37],
    [8133.56, 7970.86],
    [8134.73, 7969.36],
    [8135.91, 7967.88],
    [8137.08, 7966.41],
    [8138.26, 7964.95],
    [8139.43, 7963.5],
    [8140.61, 7962.06],
    [8141.79, 7960.63],
    [8142.96, 7959.21],
    [8144.14, 7957.8],
    [8145.31, 7956.41],
    [8146.49, 7955.02]
], ARC4: [
    [8028.92, 8237.52],
    [8032.62, 8237.89],
    [8036.32, 8238.24],
    [8040.02, 8238.56],
    [8043.73, 8238.86],
    [8047.43, 8239.14],
    [8051.13, 8239.39],
    [8054.83, 8239.61],
    [8058.53, 8239.81],
    [8062.23, 8239.99],
    [8065.94, 8240.14],
    [8069.64, 8240.27],
    [8073.34, 8240.38],
    [8077.04, 8240.46],
    [8080.74, 8240.51],
    [8084.44, 8240.54],
    [8088.14, 8240.55],
    [8091.85, 8240.53],
    [8095.55, 8240.49],
    [8099.25, 8240.42],
    [8102.95, 8240.33],
    [8106.65, 8240.22],
    [8110.35, 8240.08],
    [8114.06, 8239.92],
    [8117.76, 8239.73],
    [8121.46, 8239.52],
    [8125.16, 8239.28],
    [8128.86, 8239.02],
    [8132.56, 8238.73],
    [8136.27, 8238.42],
    [8139.97, 8238.09],
    [8143.67, 8237.73],
    [8147.37, 8237.34],
    [8151.07, 8236.94],
    [8154.77, 8236.5],
    [8158.47, 8236.04],
    [8162.18, 8235.56],
    [8165.88, 8235.05],
    [8169.58, 8234.52],
    [8173.28, 8233.96],
    [8176.98, 8233.38],
    [8180.68, 8232.77],
    [8184.39, 8232.13],
    [8188.09, 8231.47],
    [8191.79, 8230.79],
    [8195.49, 8230.08],
    [8199.19, 8229.34],
    [8202.89, 8228.58],
    [8206.59, 8227.79],
    [8210.3, 8226.97],
    [8214, 8226.13],
    [8217.7, 8225.27],
    [8221.4, 8224.37],
    [8225.1, 8223.45],
    [8228.8, 8222.51],
    [8232.51, 8221.53],
    [8236.21, 8220.53],
    [8239.91, 8219.51],
    [8243.61, 8218.45],
    [8247.31, 8217.37],
    [8251.01, 8216.26],
    [8254.71, 8215.12],
    [8258.42, 8213.96],
    [8262.12, 8212.76],
    [8265.82, 8211.54],
    [8269.52, 8210.29],
    [8273.22, 8209.01],
    [8276.92, 8207.71],
    [8280.63, 8206.37],
    [8284.33, 8205],
    [8288.03, 8203.61],
    [8291.73, 8202.18],
    [8295.43, 8200.73],
    [8299.13, 8199.24],
    [8302.84, 8197.72],
    [8306.54, 8196.18],
    [8310.24, 8194.6],
    [8313.94, 8192.99],
    [8317.64, 8191.35],
    [8321.34, 8189.67],
    [8325.04, 8187.97],
    [8328.75, 8186.23],
    [8332.45, 8184.46],
    [8336.15, 8182.65],
    [8339.85, 8180.82],
    [8343.55, 8178.94],
    [8347.25, 8177.04],
    [8350.96, 8175.1],
    [8354.66, 8173.12],
    [8358.36, 8171.11],
    [8362.06, 8169.06],
    [8365.76, 8166.98],
    [8369.46, 8164.85],
    [8373.16, 8162.69],
    [8376.87, 8160.5],
    [8380.57, 8158.26],
    [8384.27, 8155.99],
    [8387.97, 8153.67],
    [8391.67, 8151.32],
    [8395.37, 8148.92],
    [8399.08, 8146.49]
], ARC5: [
    [8146.49, 7955.02],
    [8199.17, 8229.34]
]}};
Logger.useDefaults();
Logger.setLevel(Logger.INFO);
var NS = window.NS || {};
NS.FF = !!(window.mozInnerScreenX);
window.addEventListener("message", function (event) {
    if (event.data == "bookready") {
        Logger.debug("Event bookready has been received from iframe '" + event.source.document.title + "'");
        window.bookReady = true;
    }
}, false);
window.addEventListener("message", function (event) {
    var data = {};
    try {
        data = JSON.parse(event.data);
    } catch (e) {
        Logger.warn("Malformed JSON '" + event.data + "'. Error: " + e);
    }
    if (data.type == "link") {
        Logger.debug("Linking to parent page '" + data.page + "'");
        document.location.hash = "!/" + data.page;
    }
}, false);
$(function () {
    NS.html = $("html");
    NS.body = $("body");
    NS.mainMenu = $("#main_menu");
    NS.isOldIE = (NS.html).is(".ie");
    NS.isIE = NS.isOldIE || (NS.html).is(".ie10");
    NS.DEBUG = NS.DEBUG || {};
    NS.CONST = NS.CONST || {};
    NS.$cloud = $("#cloud_uber,#main_bg_nuages");
    NS.timeoutID = 0;
    NS.$body = $("body");
    NS.$window = $(window);
    NS.$home = $("#home");
    NS.scrollModulo = 0;
    NS.$cloud_uber = $("#cloud_uber, #main_logo");
    NS.$one_cloud_uber = $("#cloud_uber");
    NS.avalonRefs = NS.avalonRefs || {};
});
function AppViewModel() {
    var NS = window.NS;
    var self = this;
    var notImg = function (event) {
        var e = $.event.fix(event);
        var target = e.target;
        return !($(target).is("img"));
    };
    var bodyScrollInit = function () {
        NS.body[0].scrollTop = 0;
    };
    self.ffalse = function () {
        return false;
    };
    self.ftrue = function () {
        return true;
    };
    self.cloudUberStepBack = function () {
        NS.$one_cloud_uber.removeClass("z3").addClass("z0");
    };
    self.cloudUberStepFront = function () {
        NS.$one_cloud_uber.removeClass("z0").addClass("z3");
    };
    self.stopFiori = function () {
        window.clearTimeout(NS.timeoutID);
        NS.$cloud.removeClass("moves");
        NS.timeoutID = window.setTimeout(function () {
            NS.$cloud.addClass("moves");
            window.clearTimeout(NS.timeoutID);
        }, 1000);
    };
    self.removeFiori = function () {
        NS.$cloud.removeClass("moves");
    };
    self.addFiori = function () {
        NS.$cloud.addClass("moves");
    };
    self.iframeBookSrc = ko.observable("about:blank");
    self.isNotFullScreen = ko.observable(true);
    self.isModelesPage = ko.observable(false);
    self.bodyScrollInit = bodyScrollInit;
    self.notImg = notImg;
    self.fadeIn = function (page, callback) {
        $(page.element).fadeIn("slow", callback);
    };
    self.fadeOut = function (page, callback) {
        self.hidePops();
        $(page.element).hide(0, function () {
            $(page.element).hide();
            self.bodyScrollInit();
            if (callback) {
                callback();
            }
        });
    };
    self.scrollToId = function (id) {
        var $id = $("#" + id);
        var dom = null;
        if (!_.isEmpty($id)) {
            dom = $id.get(0);
            dom.scrollIntoView();
        }
    };
    self.showTwitter = ko.observable(false);
    self.sharingPageTitle = ko.observable();
    self.fullUrl = ko.observable("#");
    self.subpageIsMouseOver = ko.observable(false);
    self.map = ko.observable(null);
    self.mapDom = $("#map");
    self.staticMapDom = $("#static_map");
    self.staticMapGridDom = $("#static_map_grid");
    self.haloDom = $("#halo");
    self.haloMapDom = $("#halo_map");
    self.hublot_content_container = $("#hublot_content_container");
    self.modelesTopPage = $("#modeles .top-page");
    self.showStaticMap = function () {
        self.haloDom.show("fast");
        self.staticMapDom.show("fast");
        self.staticMapGridDom.show("fast");
        self.haloMapDom.hide();
        self.mapDom.hide();
        self.modelesTopPage.removeClass("fixed");
    };
    self.showDynamicMap = function () {
        var map = self.map();
        self.haloDom.hide();
        self.staticMapDom.hide();
        self.staticMapGridDom.hide();
        self.haloMapDom.show();
        self.mapDom.show();
        self.modelesTopPage.addClass("fixed");
        if (map) {
            map.invalidateSize(true);
        }
    };
    self.showSlowDynamicMap = function () {
        var map = self.map();
        self.haloDom.hide("slow");
        self.staticMapDom.hide("slow");
        self.staticMapGridDom.hide("slow");
        self.haloMapDom.show();
        self.mapDom.show();
        self.modelesTopPage.addClass("fixed");
        if (map) {
            map.invalidateSize(true);
        }
    };
    self.afterShowProductFiche = function (data) {
        self.showStaticMap();
    };
    self.beforeHideTocModels = function () {
        self.showStaticMap();
        self.isModelesPage(false);
    };
    self.coord1 = [5.2, -1];
    self.coord2 = [3, -0.55];
    self.coord3 = [1, 4.55];
    self.coord4 = [0, 0];
    self.coord5 = [-1, 5];
    self.coord6 = [-1, -3.5833];
    self.coord7 = [-1.55, 4];
    self.coord8 = [-2.8333, -3.5833];
    self.marker1 = ko.observable(null);
    self.marker2 = ko.observable(null);
    self.marker3 = ko.observable(null);
    self.marker4 = ko.observable(null);
    self.marker5 = ko.observable(null);
    self.marker6 = ko.observable(null);
    self.marker7 = ko.observable(null);
    self.marker8 = ko.observable(null);
    self.coords = ko.computed(function () {
        var that = this;
        return{"5_12N_10": that.coord1, "3N_O33O": that.coord2, "1N_4E": that.coord3, auspibor: that.coord4, "1S_5E": that.coord5, "1S_3_35O": that.coord6, "1_33S_4_E": that.coord7, "2_50S_3_35O": that.coord8};
    }, self);
    self.markers = ko.computed(function () {
        var that = this;
        return{"5_12N_10": that.marker1(), "3N_O33O": that.marker2(), "1N_4E": that.marker3(), auspibor: that.marker4(), "1S_5E": that.marker5(), "1S_3_35O": that.marker6(), "1_33S_4_E": that.marker7(), "2_50S_3_35O": that.marker8()};
    }, self);
    self.project = function (arr) {
        var map = this.map();
        return map ? map.project(arr, 6) : null;
    };
    self.unproject = function (arr) {
        var map = this.map();
        var point = new L.Point(arr[0], arr[1]);
        return map ? map.unproject(point, 6) : null;
    };
    self.pointToLatLngs = _.memoize(function (points) {
        var result = null;
        result = _.map(points, function (point) {
            var map = self.map();
            if (!map) {
                return null;
            }
            var x = point[0], y = point[1];
            return map.unproject(new L.Point(x, y), 6);
        });
        return result;
    });
    self.closePopup = function () {
        var map;
        map = self.map();
        map && map.closePopup();
    };
    self.revealProductOnMap = function (id, zoom) {
        var coord = null;
        var marker = null;
        var map = null;
        coord = (self.coords())[id];
        marker = (self.markers())[id];
        map = self.map();
        self.marker1().addTo(map);
        self.marker2().addTo(map);
        self.marker3().addTo(map);
        self.marker4().addTo(map);
        self.marker5().addTo(map);
        self.marker6().addTo(map);
        self.marker7().addTo(map);
        self.marker8().addTo(map);
        self.map().setZoom(zoom);
        self.map().panTo([coord[0] + 2.5, coord[1]]);
        marker.openPopup();
    };
    self.mouseOverProduct = function (data, event) {
        if (data.parentPage.val("alt_id") !== "modeles") {
            return true;
        }
        var id = null;
        id = data.val("id");
        self.revealProductOnMap(id, 6);
    };
    self._drawSpi = function (_style) {
        var map = self.map();
        if (!map) {
            return;
        }
        var pathOptionsIn = null;
        var arc1 = NS.POLYLINES.SPI.ARC1;
        var arc2 = NS.POLYLINES.SPI.ARC2;
        var arc3 = NS.POLYLINES.SPI.ARC3;
        var arc4 = NS.POLYLINES.SPI.ARC4;
        var arc5 = NS.POLYLINES.SPI.ARC5;
        var latLngs1 = self.pointToLatLngs(arc1);
        var latLngs2 = self.pointToLatLngs(arc2);
        var latLngs3 = self.pointToLatLngs(arc3);
        var latLngs4 = self.pointToLatLngs(arc4);
        var latLngs5 = self.pointToLatLngs(arc5);
        pathOptionsIn = {stroke: true, color: _style.color || "#608BD4", weight: _style.weight || 5, fill: false, clickable: false, smoothFactor: 0.9};
        L.multiPolyline([latLngs1, latLngs2, latLngs3, latLngs4, latLngs5], pathOptionsIn).addTo(map);
    };
    self.drawSpi = function () {
        self._drawSpi({color: "#608BD4", weight: 5});
        self._drawSpi({color: "#7cbcc8", weight: 2});
        self._drawSpi({color: "#ffffff", weight: 1});
    };
    self.drawOneStarCircleMarker = function (coord, radius) {
        var map = self.map();
        var range = _.range(1, radius, 1);
        var size = range[range.length - 1];
        if (map) {
            Logger.debug("-->self.drawOneStarCircleMarker");
            _.each(range, function (item) {
                var pathOption = {color: "#ffffff", radius: item, fill: true, stroke: false, fillOpacity: 1 - Math.pow(item / size, 0.3)};
                Logger.debug("pathOption", pathOption);
                L.circleMarker(coord, pathOption).addTo(map);
                Logger.debug("self.drawOneStarCircleMarker-->");
            });
        }
    };
    self.drawCircleMarkers = function () {
        self.drawOneStarCircleMarker(self.coord1, 20);
        self.drawOneStarCircleMarker(self.coord2, 20);
        self.drawOneStarCircleMarker(self.coord3, 20);
        self.drawOneStarCircleMarker(self.coord4, 30);
        self.drawOneStarCircleMarker(self.coord5, 20);
        self.drawOneStarCircleMarker(self.coord6, 20);
        self.drawOneStarCircleMarker(self.coord7, 20);
        self.drawOneStarCircleMarker(self.coord8, 20);
    };
    self.showBackdrop = function () {
        NS.$backdrop.show();
    };
    self.hideBackdrop = function () {
        NS.$backdrop.hide();
        self.onPageInit();
    };
    var osmUrl = "http://{s}.tiles.mapbox.com/v3/chakazulufr.map-rgryprbn/{z}/{x}/{y}.png";
    var strSpiShirt = "<span class='auspibor-font  bleu-auspibor text-shadow'>SPI&thinsp;&thinsp;S</span><span class='text-shadow  bleu-auspibor'>H</span><span class='auspibor-font bleu-auspibor text-shadow'>IR</span><span class='text-shadow bleu-auspibor'>T</span>";
    var osm2 = null;
    var miniMap = null;
    var popOptions = {closeButton: false, minWidth: 100};
    var mainCircleMarkersPathOptions = {color: "#ffffff", radius: 3, fill: true, stroke: false, fillOpacity: 1};
    self.afterShowTocModels = function () {
        var map = self.map();
        if (!map) {
            map = L.map("map").setView([self.coord3[0] + 5, self.coord3[0] + 2], 3);
            L.Icon.Default.imagePath = NS.CONST.ABS_PATH + "css/images";
            self.map(map);
            L.tileLayer(osmUrl, {attribution: "Auspibor.com", opacity: 1}).addTo(map);
            if (!NS.isOldIE) {
                osm2 = new L.TileLayer(osmUrl, {minZoom: 0, maxZoom: 18, attribution: ""});
                miniMap = new L.Control.MiniMap(osm2).addTo(map);
            }
            self.drawSpi();
            self.drawCircleMarkers();
            self.marker1(L.circleMarker(self.coord1, mainCircleMarkersPathOptions).bindPopup(strSpiShirt + "<br /><span class='maian-font bleu-auspibor'>5°12'N 1°O</span><br /><br /><img src='" + NS.CONST.ABS_PATH + "img/produits/spishirt_5_12N_10_mini.jpg' alt='' />", popOptions));
            self.marker2(L.circleMarker(self.coord2, mainCircleMarkersPathOptions).bindPopup(strSpiShirt + "<br /><span class='maian-font bleu-auspibor'>3°N 0°33'O</span><br /><br /><img src='" + NS.CONST.ABS_PATH + "img/produits/spishirt_3N_O33O_mini.jpg' alt='' />", popOptions));
            self.marker3(L.circleMarker(self.coord3, mainCircleMarkersPathOptions).bindPopup(strSpiShirt + "<br /><span class='maian-font bleu-auspibor'>1°N 4°E</span><br /><br /><img src='" + NS.CONST.ABS_PATH + "img/produits/spishirt_1N_4E_mini.jpg' alt='' />", popOptions));
            self.marker4(L.circleMarker(self.coord4, mainCircleMarkersPathOptions).bindPopup(strSpiShirt + "<br /><span class='auspibor-font bleu-auspibor text-shadow'>AUSPIBOR</span><br /><br /><img src='" + NS.CONST.ABS_PATH + "img/produits/spishirt_auspibor_mini.jpg' alt='' />", popOptions));
            self.marker5(L.circleMarker(self.coord5, mainCircleMarkersPathOptions).bindPopup(strSpiShirt + "<br /><span class='maian-font bleu-auspibor'>1°S 5°E</span><br /><br /><img src='" + NS.CONST.ABS_PATH + "img/produits/spishirt_1S_5E_mini.jpg' alt='' />", popOptions));
            self.marker6(L.circleMarker(self.coord6, mainCircleMarkersPathOptions).bindPopup(strSpiShirt + "<br /><span class='maian-font bleu-auspibor'>1°S 3°35'O</span><br /><br /><img src='" + NS.CONST.ABS_PATH + "img/produits/spishirt_1S_3_35O_mini.jpg' alt='' />", popOptions));
            self.marker7(L.circleMarker(self.coord7, mainCircleMarkersPathOptions).bindPopup(strSpiShirt + "<br /><span class='maian-font bleu-auspibor'>1°33'S 4°E</span><br /><br /><img src='" + NS.CONST.ABS_PATH + "img/produits/spishirt_1_33S_4_E_mini.jpg' alt='' />", popOptions));
            self.marker8(L.circleMarker(self.coord8, mainCircleMarkersPathOptions).bindPopup(strSpiShirt + "<br /><span class='maian-font bleu-auspibor'>2°50'S 3°35'O</span><br /><br /><img src='" + NS.CONST.ABS_PATH + "img/produits/spishirt_2_50S_3_35O_mini.jpg' alt='' />", popOptions));
        }
        self.isModelesPage(true);
        self.showDynamicMap();
    };
    self.hidePops = function (data, event) {
        $(self.pops).popover("hide");
    };
    self.goToFr = function (data, event) {
        var hash = document.location.hash;
        document.location = NS.CONST.ABS_REAL_PATH + "fr/" + hash;
    };
    self.goToEn = function (data, event) {
        var hash = document.location.hash;
        document.location = NS.CONST.ABS_REAL_PATH + "en/" + hash;
    };
    self.goToIt = function (data, event) {
        var hash = document.location.hash;
        document.location = NS.CONST.ABS_REAL_PATH + "it/" + hash;
    };
    self.goToEs = function (data, event) {
        var hash = document.location.hash;
        document.location = NS.CONST.ABS_REAL_PATH + "es/" + hash;
    };
    self.goToPt = function (data, event) {
        var hash = document.location.hash;
        document.location = NS.CONST.ABS_REAL_PATH + "pt/" + hash;
    };
    self.goToDe = function (data, event) {
        var hash = document.location.hash;
        document.location = NS.CONST.ABS_REAL_PATH + "de/" + hash;
    };
    Seadragon.Config.imagePath = NS.CONST.ABS_REAL_PATH + "img/ui/";
    self.imgBasePath = ko.observable(NS.CONST.ABS_REAL_PATH + "img");
    self.goToZoom = function (page, event) {
        var spritespinid = page.val("spritespinid");
        var $spritespin = $("#" + spritespinid);
        var spritespin = $spritespin[0];
        var _loadSeaDragon = $.data(spritespin, "loadSeaDragon");
        Logger.debug("->goToZoom", {spritespinid: spritespinid, spritespin: spritespin, _loadSeaDragon: _loadSeaDragon});
        if (_loadSeaDragon) {
            _loadSeaDragon();
        } else {
            Logger.debug("goToZoom: _loadSeaDragon non défini");
        }
    };
    self.loadTranspSpriteSpin = function (obj) {
        var idContainer;
        var idProduct;
        var prefixProductName;
        var incr0;
        var prefix;
        var src;
        var $spritespin;
        var nbreImg = 24;
        idContainer = "#" + obj.idContainer;
        idProduct = obj.idProduct;
        prefixProductName = obj.prefixProductName;
        incr0 = obj.incr0 - 1;
        prefix = [self.imgBasePath(), idProduct, "360/225_225_transp", prefixProductName + "-"].join("/");
        src = (function (_incr) {
            var tab = [];
            for (var i = 1; i <= nbreImg; i++) {
                tab.push(prefix + (_incr + i) + ".png");
            }
            return tab;
        })(incr0);
        $spritespin = $(idContainer);
        if ($spritespin.length <= 0) {
            return;
        }
        $spritespin.spritespin({width: 225, height: 225, frames: nbreImg, sense: -1, source: src, animate: false});
    };
    self.loadHomeSpriteSpin = function () {
        var obj = {idContainer: "home_spritespin", idProduct: "1_33S_4_E", prefixProductName: "AUSPIBOR-Polo-beige rose", incr0: 4987};
        self.loadTranspSpriteSpin(obj);
    };
    self.home_spritespin_play = function (page, event) {
        var $spritespin = $("#home_spritespin");
        $spritespin.spritespin("animate", true).spritespin("loop", true);
    };
    self.home_spritespin_stop = function (page, event) {
        var $spritespin = $("#home_spritespin");
        $spritespin.spritespin("animate", false).spritespin("frame", 0).spritespin("loop", false);
    };
    self.has_3d = ko.observable(function () {
        var result = NS.CONST.HAS_3D && !NS.isIE;
        var cookieValue = $.cookie("has_3d");
        var cookieResult = false;
        if (cookieValue === undefined) {
            return result;
        } else {
            cookieResult = (cookieValue === "1");
        }
        return result && cookieResult;
    }());
    self.deactivateAvalon = function () {
        var avalonRefs = null;
        if (NS.CONST.HAS_3D) {
            avalonRefs = (NS.avalonRefs || {});
            _.each(avalonRefs, function (avalonRef, alt_id) {
                avalonRef.disable();
            });
            self.has_3d(false);
            NS.CONST.HAS_3D = false;
            $.cookie("has_3d", "0", {expires: 7, path: "/"});
        }
    };
    self.activateAvalon = function () {
        var activePage$ = null;
        var valuesPage = null;
        var altId = null;
        var avalonARef = null;
        var toLaunchPageInit = (function () {
            var cookieValue = null;
            cookieValue = $.cookie("has_3d");
            return(cookieValue === undefined) ? false : !(cookieValue === "1");
        })();
        NS.CONST.HAS_3D = true;
        self.has_3d(true);
        $.cookie("has_3d", "1", {expires: 7, path: "/"});
        if (toLaunchPageInit) {
            self.isZoomTransitionEnded = true;
            self.onPageInit();
        }
        activePage$ = pager.activePage$();
        valuesPage = activePage$.getValue() || {};
        vars = valuesPage.vars;
        altId = valuesPage.alt_id;
        avalonARef = NS.avalonRefs[altId];
        avalonARef.refresh();
    };
    self.AvalonDatazUpdater = function (avalonRef) {
        this.avalonRef = avalonRef;
        this.update = function ($el, datazVal) {
            $el.attr("data-z", datazVal);
            this.avalonRef && this.avalonRef.zRefresh($el);
        };
    };
    (function () {
        var $target = null;
        var triggerId = null;
        var $triggerId = null;
        var $home_spritespin = null;
        var $iconbookmark = null;
        var getTarget = null;
        var adzu = null;
        triggerId = "#home_ads_left";
        self.mouseoverDisplayHomeSpriteSpin = function (data, event) {
            getTarget = function () {
                $target = $(event.target);
                $triggerId = $triggerId || $(triggerId);
                $home_spritespin = $home_spritespin || $("#home_spritespin");
                $iconbookmark = $iconbookmark || $("#iconbookmark");
                return $target;
            };
            if (NS.isIE || (getTarget()).is(triggerId)) {
                self.isHublotContentContainerVisible(false);
                self.homeSpriteSpinVisble(true);
                self.loadHomeSpriteSpin();
                self.home_spritespin_play();
                if (!NS.isIE && NS.CONST.HAS_3D) {
                    adzu = adzu || new self.AvalonDatazUpdater(NS.avalonRefs.home);
                    adzu.update($triggerId, 200);
                    adzu.update($iconbookmark, 30);
                    self.cloudUberStepBack();
                    adzu.update($home_spritespin, 400);
                }
                $("#home_goto_modeles").addClass("btn-hover");
            }
        };
        self.mouseoutDisplayHomeSpriteSpin = function (data, event) {
            getTarget = function () {
                $target = $(event.target);
                $triggerId = $triggerId || $(triggerId);
                $home_spritespin = $home_spritespin || $("#home_spritespin");
                $iconbookmark = $iconbookmark || $("#iconbookmark");
                return $target;
            };
            if (NS.isIE || (getTarget()).is(triggerId)) {
                if (!NS.isIE && NS.CONST.HAS_3D) {
                    adzu = adzu || new self.AvalonDatazUpdater(NS.avalonRefs.home);
                    adzu.update($iconbookmark, 1);
                    adzu.update($home_spritespin, 1);
                    self.cloudUberStepFront();
                    adzu.update($triggerId, 75);
                }
                setTimeout(function () {
                    self.homeSpriteSpinVisble(false);
                    self.loadHomeSpriteSpin();
                    self.home_spritespin_stop();
                }, 100);
                $("#home_goto_modeles").removeClass("btn-hover");
            }
        };
    })();
    self.isHublotContentContainerVisible = ko.observable(false);
    self.mouseoverCap = function (data, event) {
        var getTarget = null;
        var $target = null;
        var $h2_cap = null;
        var adzu = null;
        getTarget = function () {
            $target = $(event.target);
            $h2_cap = $("#h2_cap");
            return $target;
        };
        if (NS.isIE || (getTarget()).is("#cap")) {
            self.isHublotContentContainerVisible(true);
            if (!NS.isIE && NS.CONST.HAS_3D) {
                adzu = new self.AvalonDatazUpdater(NS.avalonRefs.home);
                adzu.update($h2_cap, 200);
            }
        }
    };
    self.mouseoutCap = function (data, event) {
        var getTarget = null;
        var $target = null;
        var $h2_cap = null;
        var adzu = null;
        getTarget = function () {
            $target = $(event.target);
            $h2_cap = $("#h2_cap");
            return $target;
        };
        if (NS.isIE || (getTarget()).is("#cap")) {
            self.isHublotContentContainerVisible(false);
            if (!NS.isIE && NS.CONST.HAS_3D) {
                adzu = new self.AvalonDatazUpdater(NS.avalonRefs.home);
                adzu.update($h2_cap, 75);
            }
        }
    };
    self.isHublotContentBookContainerVisible = ko.observable(false);
    (function () {
        var getTarget = null;
        var $target = null;
        var $hublot_content_book = null;
        var triggerId = null;
        var $triggerId = null;
        var $iconbook = null;
        var adzu = null;
        triggerId = "#home_ads_right";
        self.mouseoverBook = function (data, event) {
            getTarget = function () {
                $target = $(event.target);
                $hublot_content_book = $hublot_content_book || $("#hublot_content_book");
                $triggerId = $triggerId || $(triggerId);
                $iconbook = $iconbook || $("#iconbook");
                return $target;
            };
            if (NS.isIE || (getTarget()).is(triggerId)) {
                self.isHublotContentContainerVisible(false);
                self.isHublotContentBookContainerVisible(true);
                if (!NS.isIE && self.has_3d()) {
                    adzu = adzu || new self.AvalonDatazUpdater(NS.avalonRefs.home);
                    adzu.update($hublot_content_book, 300);
                    self.cloudUberStepBack();
                    adzu.update($triggerId, 200);
                    adzu.update($iconbook, 30);
                }
                $("#home_goto_grimoire").addClass("btn-hover");
            }
        };
        self.mouseoutBook = function (data, event) {
            getTarget = function () {
                $target = $(event.target);
                $hublot_content_book = $hublot_content_book || $("#hublot_content_book");
                $triggerId = $triggerId || $(triggerId);
                $iconbook = $iconbook || $("#iconbook");
                return $target;
            };
            if (NS.isIE || (getTarget()).is(triggerId)) {
                if (!NS.isIE && self.has_3d()) {
                    adzu = adzu || new self.AvalonDatazUpdater(NS.avalonRefs.home);
                    adzu.update($iconbook, 1);
                    adzu.update($hublot_content_book, 1);
                    adzu.update($triggerId, 75);
                    self.cloudUberStepFront();
                }
                self.isHublotContentBookContainerVisible(false);
                $("#home_goto_grimoire").removeClass("btn-hover");
            }
        };
    })();
    self.mouseoverContact = function (data, event) {
        var getTarget = null;
        var $target = null;
        var $contact_line = null;
        var adzu = null;
        getTarget = function () {
            $target = $(event.target);
            $contact_line = $("#contact_line");
            return $target;
        };
        if (!NS.isIE && self.has_3d() && (getTarget()).is("#contact_line")) {
            adzu = new self.AvalonDatazUpdater(NS.avalonRefs.home);
            adzu.update($contact_line, 100);
        }
    };
    self.mouseoutContact = function (data, event) {
        var getTarget = null;
        var $target = null;
        var $contact_line = null;
        var adzu = null;
        getTarget = function () {
            $target = $(event.target);
            $contact_line = $("#contact_line");
            return $target;
        };
        if (!NS.isIE && self.has_3d() && (getTarget()).is("#contact_line")) {
            adzu = new self.AvalonDatazUpdater(NS.avalonRefs.home);
            adzu.update($contact_line, 1);
        }
    };
    self.loadSpriteSpin = function (obj) {
        var idContainer;
        var idSeaDragonContainer;
        var idProduct;
        var prefixProductName;
        var incr0;
        var prefix;
        var src;
        var $spritespin;
        var _loadSeaDragon;
        idContainer = "#" + obj.idContainer;
        idSeaDragonContainer = obj.idSeaDragonContainer;
        idProduct = obj.idProduct;
        prefixProductName = obj.prefixProductName;
        incr0 = obj.incr0 - 1;
        prefix = [self.imgBasePath(), idProduct, "360/225_225", prefixProductName + "-"].join("/");
        src = (function (_incr) {
            var tab = [];
            for (var i = 1; i <= 24; i++) {
                tab.push(prefix + (_incr + i) + ".jpg");
            }
            return tab;
        })(incr0);
        $spritespin = $(idContainer);
        if ($spritespin.length <= 0) {
            return;
        }
        _loadSeaDragon = function () {
            var frameIdx = $spritespin.spritespin("frame");
            var seaParams = {idContainer: idSeaDragonContainer, idProduct: idProduct, prefixProductName: prefixProductName, incr0: (incr0 + 1 + frameIdx)};
            self.loadSeaDragon(seaParams);
        };
        $.data($spritespin[0], "loadSeaDragon", _loadSeaDragon);
        $spritespin.spritespin({width: 225, height: 225, frames: 24, sense: -1, source: src, animate: true});
    };
    self.spritespin_prev = function (page, event) {
        var zoomid = page.val("zoomid");
        var $spritespin = $("#" + zoomid);
        $spritespin.spritespin("prev");
    };
    self.spritespin_play = function (page, event) {
        var zoomid = page.val("zoomid");
        var $spritespin = $("#" + zoomid);
        $spritespin.spritespin("animate", true).spritespin("loop", true);
    };
    self.spritespin_pause = function (page, event) {
        var zoomid = page.val("zoomid");
        var $spritespin = $("#" + zoomid);
        $spritespin.spritespin("animate", "toggle");
    };
    self.spritespin_stop = function (page, event) {
        var zoomid = page.val("zoomid");
        var $spritespin = $("#" + zoomid);
        $spritespin.spritespin("animate", false).spritespin("frame", 0).spritespin("loop", false);
    };
    self.spritespin_next = function (page, event) {
        var zoomid = page.val("zoomid");
        var $spritespin = $("#" + zoomid);
        $spritespin.spritespin("next");
    };
    self.loadSeaDragon = function (obj) {
        Logger.debug("Enter loadSeaDragon");
        var viewer;
        var idContainer = obj.idContainer;
        var idProduct = obj.idProduct;
        var prefixProductName = obj.prefixProductName;
        var incr0 = obj.incr0;
        var prefix = [self.imgBasePath(), idProduct, "seadragon", prefixProductName + "-" + incr0].join("/");
        if ($("#" + idContainer).length <= 0) {
            return;
        }
        viewer = new Seadragon.Viewer(idContainer);
        viewer.openDzi(prefix + "/dzc_output.xml");
        viewer.addEventListener("resize", function () {
            if (viewer.isFullPage()) {
                self.isNotFullScreen(false);
            } else {
                self.isNotFullScreen(true);
            }
        });
        Logger.debug("idContainer", idContainer);
        Logger.debug("path", prefix + "/dzc_output.xml");
    };
    self._loadProductFichePicture = function (obj) {
        self.loadSpriteSpin({idContainer: obj.idSpriteSpinContainer, idSeaDragonContainer: obj.idSeaDragonContainer, idProduct: obj.idProduct, prefixProductName: obj.prefixProductName, incr0: obj.incr0});
        self.loadSeaDragon({idContainer: obj.idSeaDragonContainer, idProduct: obj.idProduct, prefixProductName: obj.prefixProductName, incr0: obj.incr0});
    };
    self.btn_360 = ko.observable(true);
    self.btn_zoom = ko.observable(false);
    self.withOnShowloadProductFichePicture = function (callback, page) {
        Logger.debug("->withOnShowloadProductFichePicture");
        var obj = {idSpriteSpinContainer: page.val("spritespinid"), idSeaDragonContainer: page.val("seadragonid"), idProduct: page.val("idProduct"), prefixProductName: page.val("prefixProductName"), incr0: page.val("incr0")};
        Logger.debug("withOnShowloadProductFichePicture->obj: ", obj);
        self._loadProductFichePicture(obj);
        callback({btn_360: self.btn_360, btn_zoom: self.btn_zoom});
        Logger.debug("withOnShowloadProductFichePicture->");
    };
    self.afterShowloadProductFichePicture = function (page) {
        Logger.debug("->afterShowloadProductFichePicture");
        var obj = {idSpriteSpinContainer: page.val("spritespinid"), idSeaDragonContainer: page.val("seadragonid"), idProduct: page.val("idProduct"), prefixProductName: page.val("prefixProductName"), incr0: page.val("incr0")};
        Logger.debug("afterShowloadProductFichePicture->obj: ", obj);
        self._loadProductFichePicture(obj);
        Logger.debug("afterShowloadProductFichePicture->");
    };
    self.listActiveColorPageIds = ["5_12N_10", "3N_O33O", "1N_4E", "auspibor", "1S_5E", "1S_3_35O", "1_33S_4_E", "2_50S_3_35O"];
    _.each(self.listActiveColorPageIds, function (item) {
        self["isColorPage_" + item] = ko.observable(false);
    });
    self.deselectColorPage = function () {
        _.each(self.listActiveColorPageIds, function (item) {
            (self["isColorPage_" + item])(false);
        });
    };
    self.selectColorPage = function (id) {
        self.deselectColorPage();
        if (!_.contains(self.listActiveColorPageIds, id)) {
            return;
        }
        (self["isColorPage_" + id])(true);
    };
    _.each(self.listActiveColorPageIds, function (id) {
        self["selectColorPage_" + id] = function () {
            self.selectColorPage(id);
        };
    });
    self.modalPageHref = function (pagename) {
        var hash = document.location.hash;
        var pageHref;
        var pre;
        pre = pager.Href.hash + (hash.split(pager.Href.hash))[1] + "/" + pagename;
        pre = _.chain(pre.split("/")).without("").without(undefined).without("undefined").value();
        pageHref = pre.join("/");
        return pageHref;
    };
    self.homeSpriteSpinVisble = ko.observable(false);
    self.twitterScriptActivation = function () {
        !function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? "http" : "https";
            if (!d.getElementById(id)) {
                js = d.createElement(s);
                js.id = id;
                js.src = p + "://platform.twitter.com/widgets.js";
                fjs.parentNode.insertBefore(js, fjs);
            }
        }(document, "script", "twitter-wjs");
    };
    self.facebookScriptActivation = function () {
        (function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) {
                return;
            }
            js = d.createElement(s);
            js.id = id;
            js.src = "//connect.facebook.net/${vars.getFBLanguageCode()}/all.js#xfbml=1";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, "script", "facebook-jssdk"));
    };
    self.shareActivation = function () {
        setTimeout(function () {
            var cloned = null;
            Logger.debug("shareActivation");
            $(".twitter_wrapper").remove();
            $("#twitter-wjs").remove();
            cloned = ($(".post_twitter_wrapper").clone())[0];
            $(".post_twitter_share_button").removeClass("post_twitter_share_button").addClass("twitter-share-button").removeClass("none").removeClass("abs").attr("data-text", self.sharingPageTitle()).attr("data-url", self.fullUrl());
            $(".post_twitter_wrapper").removeClass("post_twitter_wrapper").addClass("twitter_wrapper").removeClass("none");
            $(".ultimate_twitter_wrapper").append(cloned);
            self.twitterScriptActivation();
            $(".dynamic_social_share").find(".fb-like").attr("data-href", self.fullUrl());
            self.facebookScriptActivation();
            (typeof FB !== "undefined") && FB.XFBML.parse();
        }, 0);
    };
    self.default3dOptions = {zAttr: "data-z", fx: function (rotation) {
        return 1.25 * rotation;
    }, fy: function (rotation) {
        return 0.5 * rotation;
    }, activeArea: {position: {y: 175}, attachment: "scroll", width: 650, height: 750}, on: {startrotation: function () {
        self.stopFiori();
    }}, animation: AvalonAnimation.Balance({to: {rx: 0, ry: 15}, from: {rx: 0, ry: -15}, duration: 3})};
    self.get3dOptions = function (clazz) {
        var that = this;
        var Default3dOptions = null;
        if (!_.isEmpty(clazz)) {
            Default3dOptions = that.default3dOptions;
            Default3dOptions["class"] = clazz;
            return Default3dOptions;
        }
        return null;
    };
    self.isZoomTransitionEnded = false;
    self.$sea = ko.observable(null);
    self.listAltIdsWith3d = ko.observableArray(["home", "brand_origine"]);
    self.onPageInit = function () {
        var that = this;
        var activePage$ = null;
        var valuesPage = null;
        var altId = null;
        var vars = null;
        var launch3d = null;
        var transitionEndHandler = null;
        activePage$ = pager.activePage$();
        valuesPage = activePage$.getValue() || {};
        vars = valuesPage.vars;
        altId = valuesPage.alt_id;
        that.fullUrl(document.location.toString());
        setTimeout(function () {
            that.sharingPageTitle("Auspibor.com - " + document.title);
        }, 60);
        NS.DEBUG.activePage$ = activePage$;
        NS.DEBUG.valuesPage = valuesPage;
        NS.DEBUG.altId = altId;
        NS.DEBUG.vars = vars;
        if (self.has_3d()) {
            launch3d = function () {
                var frame3dClass = null;
                var avalonARef = null;
                var manageAvalonRefs = null;
                avalonARef = NS.avalonRefs[altId];
                frame3dClass = valuesPage.frame3dClass;
                manageAvalonRefs = function (altId, frame3dClass) {
                    var homeAvalonRefs = null;
                    homeAvalonRefs = (NS.avalonRefs || {});
                    _.each(homeAvalonRefs, function (homeAvalonRef, alt_id) {
                        if ((alt_id != altId) && homeAvalonRef) {
                            Logger.debug("disable ", alt_id);
                            homeAvalonRef.disable();
                        }
                    });
                    if (!_.isEmpty(frame3dClass)) {
                        if (avalonARef) {
                            self.has_3d() && avalonARef.refresh();
                        } else {
                            avalonARef = AvalonA("incr_specificity", that.get3dOptions(frame3dClass));
                            NS.avalonRefs[altId] = avalonARef;
                            avalonARef.start();
                        }
                    }
                };
                NS.DEBUG.frame3dClass = frame3dClass;
                if (self.listAltIdsWith3d.indexOf(altId) >= 0) {
                    manageAvalonRefs(altId, frame3dClass);
                } else {
                    !function () {
                        var homeAvalonRefs = null;
                        homeAvalonRefs = (NS.avalonRefs || {});
                        _.each(homeAvalonRefs, function (homeAvalonRef) {
                            if (homeAvalonRef) {
                                homeAvalonRef.disable();
                            }
                        });
                    }();
                }
                NS.avalonARef = NS.avalonRefs[altId];
            };
            transitionEndHandler = function () {
                launch3d();
                that.isZoomTransitionEnded = true;
                return true;
            };
            if (that.isZoomTransitionEnded) {
                launch3d();
            } else {
                $(".page").bind("webkitTransitionEnd oTransitionEnd otransitionend transitionend msTransitionEnd", transitionEndHandler);
            }
        }
        switch (altId) {
            case"news_twitter":
                that.twitterScriptActivation();
                break;
            case"news_facebook":
                that.facebookScriptActivation();
                break;
        }
        try {
            switch (altId) {
                case"home":
                    (function () {
                        var sea = $("#sea");
                        !_.isEmpty(sea) ? sea.spStart && sea.spStart() : void (0);
                    })();
                    break;
                default:
                    (function () {
                        var sea = $("#sea");
                        !_.isEmpty(sea) ? sea.spStop && sea.spStop() : void (0);
                    })();
                    break;
            }
        } catch (e) {
        }
    };
    self.resetSocialButtons = function () {
        $(".social_button").removeClass("active");
    };
    self.toggleFacebookButton = function () {
        $("#btn_facebook").button("toggle");
    };
    self.toggleTwitterButton = function () {
        $("#btn_twitter").button("toggle");
    };
    self.attemptCount = 0;
    self.showPresBook = function () {
        $("#book_pres").removeClass("hide").addClass("in");
    };
    self.hidePresBook = function () {
        $("#book_pres").removeClass("in").addClass("out").addClass("hide");
    };
    self.musicOn = function () {
        window.bookReady && $("#bookiframe")[0].contentWindow.bookMediaControler.musicOn();
    };
    self.musicOff = function () {
        window.bookReady && $("#bookiframe")[0].contentWindow.bookMediaControler.musicOff();
    };
    self.videoPause = function () {
        window.bookReady && $("#bookiframe")[0].contentWindow.bookMediaControler.pause();
    };
    self.beforeShowLegendsPage = function (page) {
        self.removeFiori();
        NS.mainMenu.addClass("escamoted");
        return true;
    };
    self.afterShowLegendsPage = function () {
        var v = NS.viewModel;
        var m = NS.mainMenu;
        var $presb = $("#book_pres");
        self.removeFiori();
        m.addClass("escamoted");
        v.musicOn();
        if (!$presb.is(".out")) {
            $presb.removeClass("hide");
        }
        return true;
    };
    self.beforeHideLegendsPage = function () {
        var v = NS.viewModel;
        var m = NS.mainMenu;
        v.hidePresBook();
        v.musicOff();
        v.videoPause();
        m.removeClass("escamoted");
        self.addFiori();
        return true;
    };
    self.afterHideLegendsPage = function () {
        var v = null;
        v = NS.viewModel;
        v.hidePresBook();
        return true;
    };
    self.opacityFromScroll = function () {
        NS.opacityFromScroll();
    };
}
$(function () {
    var viewModel = new AppViewModel();
    NS.viewModel = viewModel;
    NS.$backdrop = $("#backdrop");
    pager.Href.hash = "#!/";
    pager.extendWithPage(viewModel);
    ko.bindingHandlers.slideVisible = {update: function (element, valueAccessor, allBindingsAccessor) {
        var value = valueAccessor(), allBindings = allBindingsAccessor();
        var valueUnwrapped = ko.utils.unwrapObservable(value);
        var duration = allBindings.slideDuration || 400;
        if (valueUnwrapped == true) {
            $(element).slideDown(duration);
        } else {
            $(element).slideUp(duration);
        }
    }};
    ko.bindingHandlers.fadeIn = {update: function (element, valueAccessor, allBindingsAccessor) {
        var value = valueAccessor(), allBindings = allBindingsAccessor();
        var valueUnwrapped = ko.utils.unwrapObservable(value);
        var duration = allBindings.slideDuration || 400;
        if (valueUnwrapped == true) {
            $(element).fadeIn(duration);
        } else {
            $(element).fadeOut(duration);
        }
    }};
    ko.applyBindings(viewModel);
    pager.start();
    pager.beforeShow.add(function (data) {
        var isModeles = ($(data.page.element).attr("data-auspibor-idpage") === "modeles") || (data.page.currentId === "products");
        if (isModeles) {
            viewModel.showDynamicMap();
            viewModel.closePopup();
        } else {
            viewModel.showStaticMap();
        }
        Logger.debug("beforeShow", data);
        var lang = AUSPIBOR.LANG.CODE;
        var route;
        try {
            route = data.page.viewModel.$__page__.route.join("/");
            Logger.debug("beforeShow for analytics: route", route);
            AUSPIBOR.DEPLOY.IS_PROD && _gaq.push(["_trackEvent", "Page", route, lang]);
        } catch (e) {
        }
        $("#share").hide();
        $("#button_share").show();
    });
    pager.afterShow.add(function (data) {
        Logger.debug("afterShow", data);
        viewModel.onPageInit();
        $("#share").hide();
        $("#button_share").show();
        NS.resetOpacityFromScroll();
    });
    pager.beforeHide.add(function (data) {
        viewModel.deselectColorPage();
        Logger.debug("beforeHide data.page", data.page.currentParentPage());
        $("#share").hide();
        $("#button_share").show();
    });
    $(".stopBubble").click(function (event) {
        event.stopPropagation();
    });
    $(".subpage").click(function (event) {
        var nextHash = null;
        if (viewModel.notImg(event)) {
            nextHash = $(this).data("next");
            if (nextHash) {
                document.location.hash = "#!/" + nextHash;
            }
        }
    });
    viewModel.pops = $("[rel='popover']");
    (viewModel.pops).popover({animation: true, placement: "top", trigger: "hover", container: "body", html: true});
    viewModel.carousel = $(".carousel").carousel({interval: 6000});
    viewModel.carousel.on("slide", function (e) {
        Logger.debug(this);
    });
    $(".trigger-tooltip").tooltip({html: true});
    $("#social_buttons").button();
    viewModel.onPageInit();
    $("#share").hide();
    var $body = NS.$body;
    var $window = NS.$window;
    var $home = NS.$home;
    var scrollModulo = NS.scrollModulo;
    var $cloud_uber = NS.$cloud_uber;
    NS.opacityFromScroll = function () {
        if (NS.$window.scrollTop() >= 80) {
            NS.$cloud_uber.addClass("opacity50");
        } else {
            NS.$cloud_uber.removeClass("opacity50");
        }
    };
    NS.resetOpacityFromScroll = function () {
        NS.$cloud_uber.removeClass("opacity50");
    };
    (!NS.isIE) && NS.$window.scroll(function () {
        NS.viewModel.stopFiori();
        if (!NS.$home.is(":visible")) {
            return;
        }
        NS.scrollModulo++;
        if (NS.scrollModulo % 5 !== 0) {
            return;
        }
        NS.opacityFromScroll();
    });
    NS.opacityFromScroll();
    $("#sea").sprite({fps: 10, no_of_frames: 10});
});